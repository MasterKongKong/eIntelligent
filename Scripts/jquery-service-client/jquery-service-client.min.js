$(document).ready(function () {
    attachBackendService();
    //var valuePlus = $.cookie("ValuePlus");
    //if (valuePlus == undefined || valuePlus == "") {
    //    location.href = "/login.aspx";
    //    return;
    //}

    //var v3Login = $.cookie("V3");
    //if (v3Login == undefined || v3Login == "")
    //    doLogin("DIMERCO.BO.RCBiz", "DIMERCO.BO.RCBiz", "Service");
});
function attachBackendService() {
    $(".backendService").each(function (i) {
        var uri = $(this).attr("uri");
        var dllName = $(this).attr("dllName");
        var nameSpace = $(this).attr("nameSpace");
        var serviceName = $(this).attr("serviceName");
        var functionName = $(this).attr("functionName");
        var paraJson = eval($(this).attr("para"));
        var succfun = eval($(this).attr("succ"));
        var thisId = this.id;

        var vP3 = $.cookie("VP3");
        if (vP3 == undefined || vP3 == "")
            doLogin(dllName, nameSpace, serviceName);

        $(this).bind("click", function (event) {
            $(this).attr("disabled", "disabled");
            var client = new jQueryBackendService(uri);
            paraVaue = paraJson();
            client.executeCommand(dllName, nameSpace, serviceName, functionName,
            paraVaue,
            function (data) {
                succfun(data, $("#" + thisId));
                $("#" + thisId).removeAttr("disabled");
            },
            function (err) {
                alert(err.message);
                $("#" + thisId).removeAttr("disabled");
            });
        });
    });
}

function doLogin(a,b,c) {
    var client = new jQueryBackendService();
    client.executeCommand(a, b, c, "Login",
        { loginName: "VP=" + $.cookie("ValuePlus") + "; ASP.NET=" + location },
        function (data) { //alert("Please process just action again."); 
            if (!data) {
                location.href = "/login.aspx";
            }
        },
        function (err) { alert(err.message); }
        );
}

var jQueryBackendService = function (n) {
    var t = function (n) {
        if (n != null)
            t.uri = n;
        else
            t.uri = location.protocol + '//' + location.host + '/v3/api/';
    };
    return t.uri = "",
	t.prototype.executeCommand = function (i, r, u, f, e, o, s) {
	    n.ajax({
	        url: t.uri + i + "/" + r + "/" + u + "/" + f,
	        type: "POST",
	        dataType: "json",
	        contentType: "application/json",
	        data: JSON.stringify(e),
	        success: function (n) {
	            if (n.hasOwnProperty("sourceException")) {
	                s(n);
	                return;
	            }
	            o(n)
	        },
	        error: function () {
	            s(data)
	        }
	    })
	},
	t
}(jQuery);
//# sourceMappingURL=jquery-service-client.min.js.map
